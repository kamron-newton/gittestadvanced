<?xml version="1.0" encoding="UTF-8"?>
<con:testCase discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" id="626702d0-938b-4f2d-af1d-770eab4dd6ae" keepSession="false" name="UpsertOrganization" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="626702d0-938b-4f2d-af1d-770eab4dd6aefileName">UpsertOrganization</con:setting>
    <con:setting id="GeneratableJUnitReport@Style">Multiple Pages</con:setting>
    <con:setting id="GeneratableJUnitReport@Folder">C:\Git\Reports</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep id="8789eb0f-930c-4f5a-881e-987704d982dd" name="Organizations" type="datasource">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="File">
        <con:configuration>
          <fileName>${#Project#ProjectPath}/References/Organizations.csv</fileName>
          <separator>,</separator>
          <trim>true</trim>
          <charset>Cp1252</charset>
          <quotedValues>true</quotedValues>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>OrganizationCode</con:property>
      <con:property>OrganizationDescription</con:property>
      <con:startRow>1</con:startRow>
      <con:endRow>8</con:endRow>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep id="4c461e42-fa27-429b-9130-6cde2647b786" name="GetOrganizationByCode" type="restrequest">
    <con:settings/>
    <con:config xsi:type="con:RestRequestStep" methodName="GetOrganizationByCode" resourcePath="/api/v1/referencedata/programs/organizations/{organizationCode}" service="RestAPIs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest id="4ae5207f-db40-4ca0-a4d5-2add4e928727" mediaType="application/json" name="GetOrganizationByCode">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/organizations/EB</con:originalUri>
        <con:assertion id="6aa7b0cf-c217-4215-b042-51ccddf2b1d2" name="Valid HTTP Status Codes" type="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200,404</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="organizationCode" value="${Organizations#OrganizationCode}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>organizationCode</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Accept-Language</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep id="218443fd-2ea4-445c-a5ca-58fa34fb3f78" name="OrgCondition" type="groovy">
    <con:settings/>
    <con:config>
      <script>import static com.jayway.jsonpath.JsonPath.parse
def status = context.expand( '${GetOrganizationByCode#HarResponse#$[\'status\']}' ).toInteger()
if (status != 200) 
	testRunner.gotoStepByName("AddOrganization") 
else  	
	testRunner.gotoStepByName("UpdateOrganization")</script>
    </con:config>
  </con:testStep>
  <con:testStep id="02e06cb8-3414-4bfa-8f8a-9488f728091b" name="AddOrganization" type="restrequest">
    <con:settings/>
    <con:config xsi:type="con:RestRequestStep" methodName="AddOrganization" resourcePath="/api/v1/referencedata/programs/organizations" service="RestAPIs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest id="20ecc223-84b9-4a7b-b2d9-0fcd5ac0122c" mediaType="application/json" name="AddOrganization" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:request>{
   "OrgCode" : "${Organizations#OrganizationCode}",
   "Description" : "${Organizations#OrganizationDescription}",
   "Status" : "A"
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/organizations</con:originalUri>
        <con:assertion id="79d50338-a339-4d0a-be2c-f55bcc068178" name="Valid HTTP Status Codes" type="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Accept-Language</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep id="5899d30b-5369-421b-84d1-63481fa3cf95" name="UpdateOrganization" type="restrequest">
    <con:settings/>
    <con:config xsi:type="con:RestRequestStep" methodName="UpdateOrganization" resourcePath="/api/v1/referencedata/programs/organizations/{organizationCode}" service="RestAPIs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest id="5dde7a39-6926-4ea5-aea2-e020c173828b" mediaType="application/json" name="UpdateOrganization" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:request>{
  "OrgCode":"${Organizations#OrganizationCode}",
  "Description":"${Organizations#OrganizationDescription}",
  "Status": "A"
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/organizations/organizationCode</con:originalUri>
        <con:assertion id="39e4016b-41aa-40f3-a6a4-59cd8b501ae3" name="Valid HTTP Status Codes" type="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="organizationCode" value="${Organizations#OrganizationCode}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>organizationCode</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Accept-Language</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep id="0d4b9778-3e9e-4062-8653-19c1fcf020f4" name="OrgLoop" type="datasourceloop">
    <con:settings/>
    <con:config>
      <dataSourceStep>Organizations</dataSourceStep>
      <targetStep>GetOrganizationByCode</targetStep>
      <discardResults>false</discardResults>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>8789eb0f-930c-4f5a-881e-987704d982dd</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>0d4b9778-3e9e-4062-8653-19c1fcf020f4</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>218443fd-2ea4-445c-a5ca-58fa34fb3f78</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>4c461e42-fa27-429b-9130-6cde2647b786</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>02e06cb8-3414-4bfa-8f8a-9488f728091b</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>5899d30b-5369-421b-84d1-63481fa3cf95</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:environmentSpec>
    <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
    <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
  </con:environmentSpec>
</con:testCase>
