<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="556b3231-95f3-4851-b5ea-ccd5c0c47e7b" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="AddProfilePerProgram" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="556b3231-95f3-4851-b5ea-ccd5c0c47e7bfileName">AddProfilePerProgram</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="datasource" name="Profile" id="79d6c7b4-831b-4989-910b-5ef32c8c5cc4">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="File">
        <con:configuration>
          <fileName>${#Project#ProjectPath}/References/Profile.csv</fileName>
          <separator>,</separator>
          <trim>true</trim>
          <charset>Cp1252</charset>
          <quotedValues>false</quotedValues>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>Row</con:property>
      <con:property>ProgramCode</con:property>
      <con:property>Prefix</con:property>
      <con:property>FirstName</con:property>
      <con:property>MiddleInit</con:property>
      <con:property>LastName</con:property>
      <con:property>Suffix</con:property>
      <con:property>CardNumber</con:property>
      <con:property>GlobalOptOut</con:property>
      <con:property>GlobalOptDate</con:property>
      <con:property>GlobalOptSource</con:property>
      <con:property>LanguageCode</con:property>
      <con:property>MaritalStatus</con:property>
      <con:property>Gender</con:property>
      <con:property>BirthDate</con:property>
      <con:property>CompanyName</con:property>
      <con:property>Country</con:property>
      <con:property>UpdatedCountry</con:property>
      <con:property>AddressLine1</con:property>
      <con:property>AddressLine2</con:property>
      <con:property>AddressLine3</con:property>
      <con:property>City</con:property>
      <con:property>StateCode</con:property>
      <con:property>CountryCode</con:property>
      <con:property>PostalCode</con:property>
      <con:property>AddressChannelCode</con:property>
      <con:property>AddressLocationCode</con:property>
      <con:property>AddressIsPreferred</con:property>
      <con:property>AddressDeliveryStatus</con:property>
      <con:property>DoNotStandardize</con:property>
      <con:property>EmailAddress</con:property>
      <con:property>EmailChannelCode</con:property>
      <con:property>EmailLocationCode</con:property>
      <con:property>EmailIsPreferred</con:property>
      <con:property>EmailDeliveryStatus</con:property>
      <con:property>PhoneNumber</con:property>
      <con:property>PhoneCountryCode</con:property>
      <con:property>AcceptsText</con:property>
      <con:property>Frequency</con:property>
      <con:property>PhoneChannelCode</con:property>
      <con:property>PhoneLocationCode</con:property>
      <con:property>PhoneIsPreferred</con:property>
      <con:property>PhoneDeliveryStatus</con:property>
      <con:property>SourceCode</con:property>
      <con:property>JoinDate</con:property>
      <con:property>EnrollChannelCode</con:property>
      <con:property>TierCode</con:property>
      <con:property>Username</con:property>
      <con:property>Password</con:property>
      <con:property>TermsConditionsAcceptedInd</con:property>
      <con:property>ActivityDate</con:property>
      <con:property>CreateFileId</con:property>
      <con:property>CreateRecordNumber</con:property>
      <con:property>UpdateFileId</con:property>
      <con:property>UpdateRecordNumber</con:property>
      <con:property>AutoRewardOptInInd</con:property>
      <con:property>GamerAlias</con:property>
      <con:property>GamerAvatar</con:property>
      <con:property>PostingKeyCode</con:property>
      <con:property>PostingKeyValue</con:property>
      <con:property>EnrollmentStoreCode</con:property>
      <con:property>InvalidSourceCode</con:property>
      <con:startRow>1</con:startRow>
      <con:endRow/>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep type="datasource" name="PostingKeyRanNumber" id="efebc707-d3a2-48b1-baff-9ef11b7a1e98">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="Data Generator">
        <con:configuration>
          <generatedDataCount>10</generatedDataCount>
          <generatorsTotalNumber>1</generatorsTotalNumber>
          <lastSelectedProperty>0</lastSelectedProperty>
          <GeneratorType0>INT</GeneratorType0>
          <PropertyName0>RandomNumber</PropertyName0>
          <repetitionCountRandomNumber>0</repetitionCountRandomNumber>
          <repeatValuesRandomNumber>false</repeatValuesRandomNumber>
          <IntegerDataGeneratorMinValueRandomNumber>1</IntegerDataGeneratorMinValueRandomNumber>
          <IntegerDataGeneratorMaxValueRandomNumber>100000</IntegerDataGeneratorMaxValueRandomNumber>
          <IntegerDataGeneratorStepValueRandomNumber>1</IntegerDataGeneratorStepValueRandomNumber>
          <IntegerDataGeneratorConsequentValuesRandomNumber>false</IntegerDataGeneratorConsequentValuesRandomNumber>
          <escapeSpaceSequence/>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>RandomNumber</con:property>
      <con:startRow>1</con:startRow>
      <con:endRow/>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="GetProgramCode" id="3fb6dbb0-50cd-4831-b945-beb7789c41fb">
    <con:settings/>
    <con:config>
      <script>def basicProgramCode = context.expand('${#Project#ProgramCode}')
def fileProgramCode =  context.expand('${Profile#ProgramCode}')

if(basicProgramCode == fileProgramCode)
  testRunner.gotoStepByName("GetPostingKeys")
  else 
   testRunner.gotoStepByName("GetPostingKeyByCode")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="GetPostingKeys" id="d2a6154e-0f7c-41c7-b96e-9b0293bba091">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/postingkeys" methodName="GetPostingKeys" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="GetPostingKeys" id="e05cf6a0-850f-4042-86bc-b06a54238557" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/postingkeys</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="71760b97-4e03-4ed7-b682-4eaab52c0f00" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="postingKeyCode" value="${Profile#PostingKeyCode}"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="status" value="A"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>postingKeyCode</con:entry>
          <con:entry>status</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="GetPostingKeyCode" id="56827049-e2fd-4c99-ac37-12a868274c68">
    <con:settings/>
    <con:config>
      <script>import static com.jayway.jsonpath.JsonPath.parse

def postingKeyCode = context.expand( '${GetPostingKeys#Response#$[0][\'PostingKeyCode\']}' )
if (postingKeyCode == "" ) 
    testRunner.gotoStepByName("AddPostingKey")
    else 
        testRunner.gotoStepByName("Run AddProfileWithPostingKey")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="AddPostingKey" id="fa57c4d9-6fd3-4319-9cd7-5364956e88f7">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/postingkeys" methodName="AddPostingKey" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="AddPostingKey" id="762f2188-58bf-4b48-accc-d02810be2eb8" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "PostingKeyCode": "${Profile#PostingKeyCode}${PostingKeyRanNumber#RandomNumber}",
  "PostingKeyName": "PKey${PostingKeyRanNumber#RandomNumber}",
  "PostingKeyDescription": "AutPKey${PostingKeyRanNumber#RandomNumber}",
  "PostingKeyMaxLength": "50",
  "IsSystemGenerated": "false",
  "IsSecure": "false"
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/postingkeys</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="baffd191-aea1-4ac6-8314-1962f4dd17c2" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#ProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="Run AddProfileWithPostingKey" id="44b0d183-5a1f-4f8b-829c-ed60c98f9bcf">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>baad9bb0-ef1d-40cc-ad6c-120db1b5f415</con:targetTestCase>
      <con:properties/>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="GetProfileByID" id="22395b1c-4206-4bb1-acd8-913301baeb91">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/profiles/{profileId}" methodName="GetProfileByID" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest id="caa82c6c-fb0c-4527-9a62-8abf1c42fa9d" mediaType="application/json" name="GetProfileByID">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/profiles/3463a27d-a04a-4ea1-8fb8-c05a4063cd61</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="0388e0df-02b3-4bde-b31a-d3f74bd8d309" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="JsonPath Match" id="0d225bb3-ec04-4a94-9d94-2568529f315c" name="JSONPath Match">
          <con:configuration>
            <path>$['ProfileId']</path>
            <content>${#[Profile#AddProfileWithPostingKey#AddProfileWithPostingKey]#Response#$['ProfileId']}</content>
            <allowWildcards>false</allowWildcards>
            <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
            <ignoreComments>false</ignoreComments>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="profileId" value="${#[Profile#AddProfileWithPostingKey#AddProfileWithPostingKey]#Response#$['ProfileId']}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#ProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>profileId</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Accept-Language</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>79d6c7b4-831b-4989-910b-5ef32c8c5cc4</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>efebc707-d3a2-48b1-baff-9ef11b7a1e98</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
