<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="260b6352-f2dc-43c9-af28-a3f1df7a6555" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Location Bonus" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="260b6352-f2dc-43c9-af28-a3f1df7a6555fileName">Location-Bonus</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="restrequest" name="ProcessMarketingEventLocationBonus" id="02161889-e9d8-4ab1-8f2b-a73c26e5f99a">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/engage/marketingevent" methodName="ProcessMarketingEvent" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="ProcessMarketingEventLocationBonus" id="c3da61b0-81ba-449f-abb7-d1e58290c294" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{

	"MarketingEventChannels": [
		{

			"MarketingEventChannelId": "bce4fc4f-1b7d-2d49-b498-cea4e90a6105",
			"ChannelName": "No Channel"
		}
	],
    "EventName": "OFFER_NAME${=new java.text.SimpleDateFormat("mmddyyyyhhmmssmmm").format(new Date())}", 	
		"EventCode": "OFFER_CODE${=new java.text.SimpleDateFormat("mmddyyyyhhmmssmmm").format(new Date())}", 
	"PackagedAudience": {
		"PackagedAudienceId": "7ae1f987-515e-4669-e053-5ca8e70ad3ee",
		"AudienceName": "All Members",
	},
	"AudienceSource": "PACKAGED_AUDIENCE",
	"PackagedOffer": {
		"PackagedOfferId": "6c029289-c3c3-437d-b726-9c276fce02c3",
		"PackagedOfferCode": "LOCATION_BONUS",
		"PackagedOfferName": "Location Bonus",
		"PackagedOfferParams": [
			{
	            "PackagedOfferParamId": "7f15ef55-0408-4363-b1af-f2cb26a1a8a8",
				"PackagedOfferId": "6c029289-c3c3-437d-b726-9c276fce02c3",
				"ParamName": "Minimum transaction amount (optional)",
				"ParamCode": "MINIMUM_PURCHASE_AMOUNT",	
				"Value": "100",
				"PanelId": "e0e698ac-4191-d25d-e053-5dedef0ac6ef",
				"PanelCode": "CUSTOMER_ACTIVITY"
			},

			{
				"PackagedOfferParamId": "21ba4059-780f-4997-b9b2-23984fc31ceb",
				"PackagedOfferId": "6c029289-c3c3-437d-b726-9c276fce02c3",
				"ParamName": "Points per eligible dollar",
				"ParamCode": "POINTS_PER_ELIG_DOLLAR",
				"Value": "0.15",
				"PanelId": "e0e698ac-4291-d25d-e053-5dedef0ac6ef",
				"PanelCode": "CUSTOMER_REWARD"
			},
			{
				"PackagedOfferParamId": "2f671272-2402-4f3d-bc6c-828f174652c8",
				"PackagedOfferId": "6c029289-c3c3-437d-b726-9c276fce02c3",
				"ParamName": "Transact at",
				"ParamCode": "LOCATION",
				"Value": "StoreCode in (\"FR1523\")",
				 "ParamCustomValue": {
          "StoreCode": [
            "FR1523"
          ],
          "DisplayStoreCode": [
            "FR1523 - Fall River West Region"
          ],
          "LocationSelectType": 0,
          "Chain": "FALL_RIVER"
        },
        "PanelId": "e0e698ac-4191-d25d-e053-5dedef0ac6ef",
        "PanelCode": "CUSTOMER_ACTIVITY"
			}
		],
		"PackagedOfferCategoryId": "17872aea-5187-8d43-a4be-555c17300611",
		"PackagedOfferCategoryCode": "TEMPLATES"
	},
	"OfferStartDate": "${=new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ").format(new Date()+4)}",
	"OfferEndDate": "${=new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ").format(new Date()+15)}",


	"BusinessUnitTimeZone": "UTC",
	"Status": "A",

}</con:request>
        <con:originalUri>https://d2aldv-pveapi.skynetlowerenv.com/api/v1/engage/marketingevent</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="d7664c17-3abc-4b2f-93d2-ce58adf21d4f" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="validateOffer" value="false"/>
          <con:entry key="validateAudience" value="false"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#ProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>validateAudience</con:entry>
          <con:entry>validateOffer</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="47bb433b-fb70-41f0-b289-86004efd1deb">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="ApproveMarketingEvent" id="a031f72d-602e-404d-9da6-83c200f9dcb9">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>ac44e245-733a-4139-a950-3f774b513c3b</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>EventCode</con:name>
          <con:value>${ProcessMarketingEventLocationBonus#Response#$['EventCode']}</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="DeployMarketingEvent" id="643125a3-ec9a-4008-a75b-417f0c9851d3">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>4e31c31c-5e5f-4dab-8caf-7c5cf7fef68f</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>EventCode</con:name>
          <con:value>${ApproveMarketingEvent#EventCode}</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="WaitForBatchJob" id="5e5872ef-cbc2-4fb9-90b9-f72d7d7946ad">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>1525e308-cfae-4277-af49-4908cfbd9e1d</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>JobId</con:name>
          <con:value>${#[OffersPrerequisite#DeployMarketingPromotion#DeployMarketingPromotion]#Response#$['BatchJobId']}</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="AddProfileRGR" id="bcf8a836-abfe-4db3-9701-fe6ab7d47acd">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>09d0b29f-fbfa-4136-9573-3b813c1795b3</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>ProfileId</con:name>
          <con:value/>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="delay" name="Delay" id="a37b45bd-9a32-4e36-9ecc-43adc1d4f998">
    <con:settings/>
    <con:config>
      <delay>6000</delay>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="PurchaseTransaction1" id="d1174eb5-6d76-4551-a241-10ab0175c8ac">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>981060e9-8e55-4bc2-8e64-e3d2b5197f95</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>TransactionEligible</con:name>
          <con:value>100</con:value>
        </con:property>
        <con:property>
          <con:name>Nights</con:name>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="GetMomentByCode" id="318de8f8-7a09-4cbc-b2e6-3bab230f93bf">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>f4019890-b4bf-40e5-b64c-59b6bbe7b94d</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>EventCode</con:name>
          <con:value>${ProcessMarketingEventLocationBonus#Response#$['EventCode']}</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="GetPointsSummary" id="8e2efaa7-1a18-4444-aa66-8bf15852601a">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/profiles/{profileId}/points/summary" methodName="GetPointsSummary" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="GetPointsSummary" id="90aa5f43-a530-41eb-9446-2dde6c33780e" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/profiles/%7B%20%20%20%22Prefix%22%3A%22%22%2C%20%20%20%22FirstName%22%3A%20%22%22%2C%20%20%20%22MiddleInit%22%3A%22%22%2C%20%20%20%22LastName%22%3A%22%22%2C%20%20%20%22CardNumber%22%3A%22c62c3524-f4bd-4b58-ab51-8984747839a8%22%2C%20%20%20%22Suffix%22%3A%20%22%22%2C%20%20%20%22GlobalOptOut%22%3A%20%22%22%2C%20%20%20%22GlobalOptDate%22%3A%20%20%22%22%2C%20%20%20%22GlobalOptSource%22%3A%20%22%22%2C%20%20%20%22LanguageCode%22%3A%20%20%22%22%2C%20%20%20%22MaritalStatus%22%3A%20%22%22%2C%20%20%20%22Gender%22%3A%20%22%22%2C%20%20%20%22BirthDate%22%3A%20%22%22%2C%20%20%20%22CompanyName%22%3A%20%22%22%2C%20%20%20%22Addresses%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22AddressLine1%22%3A%22%22%2C%20%20%20%20%20%20%20%22AddressLine2%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22AddressLine3%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22City%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22StateCode%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22CountryCode%22%3A%20%20%22%22%2C%20%20%20%20%20%20%20%22PostalCode%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22ChannelCode%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22LocationCode%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22IsPreferred%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22DeliveryStatus%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22DoNotStandardize%22%3A%20%20%22%22%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22Emails%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22EmailAddress%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22ChannelCode%22%3A%20%20%22%22%2C%20%20%20%20%20%20%20%22LocationCode%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22IsPreferred%22%3A%20%20%22%22%2C%20%20%20%20%20%20%20%22DeliveryStatus%22%3A%20%22%22%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22Phones%22%3A%20%5B%20%20%20%20%20%7B%20%20%20%20%20%20%20%22PhoneNumber%22%3A%20%20%22%22%2C%20%20%20%20%20%20%20%22PhoneCountryCode%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22AcceptsText%22%3A%22%22%2C%20%20%20%20%20%20%20%22Frequency%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22ChannelCode%22%3A%22%22%2C%20%20%20%20%20%20%20%22LocationCode%22%3A%22%22%2C%20%20%20%20%20%20%20%22IsPreferred%22%3A%20%22%22%2C%20%20%20%20%20%20%20%22DeliveryStatus%22%3A%22%22%20%20%20%20%20%7D%20%20%20%5D%2C%20%20%20%22SourceCode%22%3A%20%22%22%2C%20%20%20%22EnrollChannelCode%22%3A%20%22%22%2C%20%20%20%22AutoRewardOptInInd%22%3A%20%20%22%22%2C%20%20%20%22TermsConditionsAcceptedInd%22%3A%20%22%22%20%20%7D/points/summary</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="a022dce5-2b60-4dcb-8b1c-2a71e54018fc" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="JsonPath Match" id="d718b76f-6e63-422d-9479-043918f3d753" name="ValidationForPointsAmount">
          <con:configuration>
            <path>$.[?(@.ActTransactionId == '${#[OffersPrerequisite#PurchaseTransaction#PurchaseTransaction]#Response#$['TransactionId']}' &amp;&amp; @.MomentId == '${#[OffersPrerequisite#GetMomentByCode#GetMomentByCode]#Response#$['MomentId']}')].PointsAmount</path>
            <content>[15.0]</content>
            <allowWildcards>false</allowWildcards>
            <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
            <ignoreComments>false</ignoreComments>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="profileId" value="${#[Profile#AddProfileRGR#AddProfileRGR]#Response#$['ProfileId']}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="status" value="A"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>profileId</con:entry>
          <con:entry>status</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="47bb433b-fb70-41f0-b289-86004efd1deb">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="DeactivateMoment" id="fb27fc10-ad16-4c1c-a54d-f3c8b7695c9b">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>c903534c-32ad-44dc-9cb6-a72fc8de1482</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>MomentId</con:name>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>PARALLELL</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="GetProgramOffers" id="3d8c4f71-6968-462a-a055-c9f78ab9e766">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>4607f14c-fd49-4eab-bc7e-4ba196bb73a9</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>EventCode</con:name>
          <con:value>${ProcessMarketingEventLocationBonus#Response#$['EventCode']}</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="UpdateProgramOffer" id="fbc6e5b1-a8d0-4172-990e-25c54a962e9b">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>25d1254f-0637-4596-a5bf-1eba1aeac44c</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>SysOfferId</con:name>
          <con:value>${#[OffersPrerequisite#GetProgramOffers#GetProgramOffers]#Response#$[0]['SysOfferId']}</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>643125a3-ec9a-4008-a75b-417f0c9851d3</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>318de8f8-7a09-4cbc-b2e6-3bab230f93bf</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
