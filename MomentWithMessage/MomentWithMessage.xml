<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="3da27e4c-a23f-4581-bb7b-f2b5e37ddd47" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="MomentWithMessage" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="3da27e4c-a23f-4581-bb7b-f2b5e37ddd47fileName">MomentWithMessage</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="datasource" name="Profile" id="b525d985-b13b-4d4e-9788-0980e8830f53">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="File">
        <con:configuration>
          <fileName>${=context.testCase.testSuite.project.path}/References/Profile.csv</fileName>
          <separator>,</separator>
          <trim>true</trim>
          <charset>Cp1252</charset>
          <quotedValues>false</quotedValues>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>Row</con:property>
      <con:property>ProgramCode</con:property>
      <con:property>Prefix</con:property>
      <con:property>FirstName</con:property>
      <con:property>MiddleInit</con:property>
      <con:property>LastName</con:property>
      <con:property>Suffix</con:property>
      <con:property>CardNumber</con:property>
      <con:property>GlobalOptOut</con:property>
      <con:property>GlobalOptDate</con:property>
      <con:property>GlobalOptSource</con:property>
      <con:property>LanguageCode</con:property>
      <con:property>MaritalStatus</con:property>
      <con:property>Gender</con:property>
      <con:property>BirthDate</con:property>
      <con:property>CompanyName</con:property>
      <con:property>Country</con:property>
      <con:property>UpdatedCountry</con:property>
      <con:property>AddressLine1</con:property>
      <con:property>AddressLine2</con:property>
      <con:property>AddressLine3</con:property>
      <con:property>City</con:property>
      <con:property>StateCode</con:property>
      <con:property>CountryCode</con:property>
      <con:property>PostalCode</con:property>
      <con:property>AddressChannelCode</con:property>
      <con:property>AddressLocationCode</con:property>
      <con:property>AddressIsPreferred</con:property>
      <con:property>AddressDeliveryStatus</con:property>
      <con:property>DoNotStandardize</con:property>
      <con:property>EmailAddress</con:property>
      <con:property>EmailChannelCode</con:property>
      <con:property>EmailLocationCode</con:property>
      <con:property>EmailIsPreferred</con:property>
      <con:property>EmailDeliveryStatus</con:property>
      <con:property>PhoneNumber</con:property>
      <con:property>PhoneCountryCode</con:property>
      <con:property>AcceptsText</con:property>
      <con:property>Frequency</con:property>
      <con:property>PhoneChannelCode</con:property>
      <con:property>PhoneLocationCode</con:property>
      <con:property>PhoneIsPreferred</con:property>
      <con:property>PhoneDeliveryStatus</con:property>
      <con:property>SourceCode</con:property>
      <con:property>JoinDate</con:property>
      <con:property>EnrollChannelCode</con:property>
      <con:property>TierCode</con:property>
      <con:property>Username</con:property>
      <con:property>Password</con:property>
      <con:property>TermsConditionsAcceptedInd</con:property>
      <con:property>ActivityDate</con:property>
      <con:property>CreateFileId</con:property>
      <con:property>CreateRecordNumber</con:property>
      <con:property>UpdateFileId</con:property>
      <con:property>UpdateRecordNumber</con:property>
      <con:property>AutoRewardOptInInd</con:property>
      <con:property>GamerAlias</con:property>
      <con:property>GamerAvatar</con:property>
      <con:property>PostingKeyCode</con:property>
      <con:property>PostingKeyValue</con:property>
      <con:property>EnrollmentStoreCode</con:property>
      <con:property>InvalidSourceCode</con:property>
      <con:startRow>1</con:startRow>
      <con:endRow>1</con:endRow>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep type="datasource" name="EnableDisableProgSettings" id="98dec0ca-1481-4849-85e1-1989c5b483e2">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="File">
        <con:configuration>
          <fileName>${#Project#ProjectPath}/References/EnableDisableProgramSettings.csv</fileName>
          <separator>,</separator>
          <trim>true</trim>
          <charset>Cp1252</charset>
          <quotedValues>false</quotedValues>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>EnablePendingTransactions</con:property>
      <con:property>EnrollmentActivation</con:property>
      <con:property>UseProductHierarchy</con:property>
      <con:property>MomentGetProfileBypass</con:property>
      <con:property>ParameterValueNo</con:property>
      <con:property>ParameterValueYes</con:property>
      <con:startRow>1</con:startRow>
      <con:endRow/>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="EnableOrDisableProgramSetting" id="98961bb1-29c4-4aca-80ae-1cdd3721c65a">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/programsettings" methodName="UpdateProgramSettings" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="EnableOrDisableProgramSetting" id="d3640b0f-5085-4ed6-8b0e-f59fb4fdaab6" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          <con:setting id="RecordRequestRepresentations">true</con:setting>
        </con:settings>
        <con:request>[
{
"ParameterName":"${EnableDisableProgSettings#EnablePendingTransactions}",
"ParameterValue": "${EnableDisableProgSettings#ParameterValueNo}"
},
{
"ParameterName": "${EnableDisableProgSettings#EnrollmentActivation}",
"ParameterValue": "${EnableDisableProgSettings#ParameterValueNo}"
},
{
"ParameterName": "${EnableDisableProgSettings#UseProductHierarchy}",
"ParameterValue": "${EnableDisableProgSettings#ParameterValueNo}"
},
{
"ParameterName": "${EnableDisableProgSettings#MomentGetProfileBypass}",
"ParameterValue": "${EnableDisableProgSettings#ParameterValueNo}"		
}
]</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/programsettings</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="990c4908-1edb-4c64-b556-4ce91bf25da3" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${Profile#ProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Authorization</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>content-type</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="UpsertMessageMoment" id="cb5289a4-b39f-46f8-8d42-768597ab639e">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/momentmgmt/moment/{momentCode}" methodName="GetMomentByCode" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="UpsertMessageMoment" id="dd52f0c5-0006-459f-bcbd-9cf595dabc6c" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/momentmgmt/moment/%24%28%23MomentWithMessage%23RGRMOMENTNAME%7D</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="9438d3d9-511c-428e-8de9-ba4480810d72" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200,404</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="momentCode" value="${#TestCase#RGRMOMENTNAME}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>momentCode</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Accept-Language</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="UpsertMessageMomentCond" id="b075b5f3-342a-453b-8fe0-d66455b0f1f7">
    <con:settings/>
    <con:config>
      <script><![CDATA[import static com.jayway.jsonpath.JsonPath.parse

def status = context.expand( '${UpsertMessageMoment#HarResponse#$[\'status\']}' ).toInteger()
def momentId = context.expand('${UpsertMessageMoment#Response#$[\'MomentId\']}')
def momentStatus = context.expand('${UpsertMessageMoment#Response#$[\'Status\']}')

testRunner.testCase.setPropertyValue( "momentid", momentId) 

if (status == 404 && momentId == "")  testRunner.gotoStepByName("CreateMoment")
else if (status == 200 && momentId != "" && momentStatus == "I")  testRunner.gotoStepByName("UpdateMoment")
else
testRunner.gotoStepByName("ActivateMoment")]]></script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="UpdateMoment" id="2fd03dd8-f719-44f2-a26f-9c92741d2541">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/momentmgmt/{momentId}" methodName="UpdateMoment" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="UpdateMoment" id="e4359f26-93ff-4eab-a884-4195a8f77ae6" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:request>{
  "MomentCode": "${#TestCase#RGRMOMENTNAME}",
  "Description": "Moment to display messages for PP profiles",
  "MomentType": "MESSAGE",
  "StartDate": "2019-07-18T00:00:00Z",
  "StartDateString": "07/18/2019 12:00:00 AM",
  "EndDate": "2022-12-31T23:59:00Z",
  "EndDateString": "12/31/2022 11:59:00 PM",
  "OldEndDate": "2022-12-31T23:59:59Z",
  "TenantId": "3e0da31e-4947-7616-e053-5ba8e70a2457",
  "MomentStatus": "A",
  "MomentEvent": {
    "MomentCode": "${#TestCase#RGRMOMENTNAME}",
    "EventType": "GetProfileById",
    "MomentQualifyingDateAttribute": "CurrentDateTime",
    "MomentQualifyingDateAttributeDrools": "$GetProfileById:GetProfileByIdC(isItBetween( new Date() ,\"07/18/2019 12:00:00 AM\",\"12/31/2022 11:59:00 PM\"))",
    "MomentOffers": [
      {
        "MomentCode": "${#TestCase#RGRMOMENTNAME}",
        "EventType": "GetProfileById",
        "OfferName": "${#TestCase#RGRMOMENTNAME}",
        "MomentOutcome": {
          "MomentCode": "${#TestCase#RGRMOMENTNAME}",
          "EventType": "GetProfileById",
          "OfferName": "${#TestCase#RGRMOMENTNAME}",
          "OutcomeEquationUi": "\"Get Message PP profiles\"",
          "CalculationTemplate": "&lt;message,[String]>",
          "OutcomeEquationTemplate": "%5B%7B%22name%22%3A%22message%22%2C%22type%22%3A%22String%22%2C%22objType%22%3A%22var%22%2C%22id%22%3A%22variable_0%22%2C%22value%22%3A%22%5C%22Get%20Message%20PP%20profiles%5C%22%22%2C%22isSelect%22%3Afalse%2C%22funcName%22%3A%22%22%2C%22filterType%22%3A%22%22%2C%22drools%22%3A%22%22%2C%22collectionAttribute%22%3Afalse%2C%22refId%22%3A%22%22%7D%2C%7B%22name%22%3A%22%22%2C%22type%22%3A%22%22%2C%22objType%22%3A%22drools%22%2C%22id%22%3A%22%22%2C%22value%22%3A%22String.valueOf(%5C%22Get%20Message%20PP%20profiles%5C%22)%22%2C%22isSelect%22%3Afalse%2C%22funcName%22%3A%22%22%2C%22filterType%22%3A%22%22%2C%22drools%22%3A%22%22%2C%22collectionAttribute%22%3Afalse%2C%22refId%22%3A%22%22%7D%5D",
          "OutcomeEquationDrools": "MomentParam[] params = new MomentParam[] {new MomentParam(\"OfferName\",\"${#TestCase#RGRMOMENTNAME}\"),new MomentParam(\"QualifyingDateAttributeValue\", new Date() )};\_r\nMomentParam[] outcomeValues = null;\_r\nmo.add(new MomentOutcome(\"${#TestCase#RGRMOMENTNAME}\",String.valueOf(\"Get Message PP profiles\"),params, outcomeValues));\_r\n",
          "FormulaName": "MESSAGE",
          "Status": "P"
         
          },
        "MomentQualifyingRule": {
          "MomentCode": "${#TestCase#RGRMOMENTNAME}",
          "EventType": "GetProfileById",
          "OfferName": "${#TestCase#RGRMOMENTNAME}",
         "RuleEquationUI": "GetProfileById.ProgramCode==\"PP\"",
         "RuleEquationDrools": "GetProfileByIdC(ProgramCode == \"PP\")",
          "Status": "P"
           
        },
        "Rank": "2",
        "Questions": null,
        "Status": "A"
             }
    ],
   
    "Status": "P"
   
  },
 
  "BestOfferIndicator": false,
  "AdvancedModeIndicator": false,
  "ReleaseState": "P",
  "IsTestUser": false,
  "Status": "A"
 
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/momentmgmt/</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="f367b875-3980-4258-81dd-f183eff0d89a" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="momentId" value="${#TestCase#momentid}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>momentId</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="UpdateMomentCond" id="fb006f39-33c8-4633-a222-6fafb44abc42">
    <con:settings/>
    <con:config>
      <script>import static com.jayway.jsonpath.JsonPath.parse

def status = context.expand( '${UpdateMoment#HarResponse#$[\'status\']}' ).toInteger()

if (status == 200)  testRunner.gotoStepByName("ActivateMoment")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="CreateMoment" id="b399d350-89e4-4665-8965-2ad5782ac357">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/momentmgmt" methodName="AddMoment" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="CreateMoment" id="a1688ce7-78e7-40b0-a3d3-fdae0cd31567" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:request>{
  "MomentCode": "${#TestCase#RGRMOMENTNAME}",
  "Description": "Moment to display messages for PP profiles",
  "MomentCode": "${#TestCase#RGRMOMENTNAME}",
  "MomentType": "MESSAGE",
  "StartDate": "2019-07-18T00:00:00Z",
  "StartDateString": "07/18/2019 12:00:00 AM",
  "EndDate": "2022-12-31T23:59:59Z",
  "EndDateString": "12/31/2022 11:59:59 PM",
  "MomentStatus": "P",
   "MomentEvent": {
    "MomentCode": "${#TestCase#RGRMOMENTNAME}",
    "EventType": "GetProfileById",
    "MomentQualifyingDateAttribute": "CurrentDateTime",
    "MomentQualifyingDateAttributeDrools": "$GetProfileById:GetProfileByIdC(isItBetween( new Date() ,\"07/18/2019 12:00:00 AM\",\"12/31/2022 11:59:59 PM\"))",
    "MomentOffers": [
      {
        "MomentCode": "${#TestCase#RGRMOMENTNAME}",
        "EventType": "GetProfileById",
        "OfferName": "${#TestCase#RGRMOMENTNAME}",
        "Description": "Moment to display messages for PP profiles",
        "MomentOutcome": {
          "MomentCode": "${#TestCase#RGRMOMENTNAME}",
          "EventType": "GetProfileById",
          "OfferName": "${#TestCase#RGRMOMENTNAME}",
          "OutcomeEquationUi": "\"Get Message PP profiles\"",
          "CalculationTemplate": "&lt;message,[String]>",
          "OutcomeEquationTemplate": "%5B%7B%22name%22%3A%22message%22%2C%22type%22%3A%22String%22%2C%22objType%22%3A%22var%22%2C%22id%22%3A%22variable_0%22%2C%22value%22%3A%22%5C%22Get%20Message%20PP%20profiles%5C%22%22%2C%22isSelect%22%3Afalse%2C%22funcName%22%3A%22%22%2C%22filterType%22%3A%22%22%2C%22drools%22%3A%22%22%2C%22collectionAttribute%22%3Afalse%2C%22refId%22%3A%22%22%7D%2C%7B%22name%22%3A%22%22%2C%22type%22%3A%22%22%2C%22objType%22%3A%22drools%22%2C%22id%22%3A%22%22%2C%22value%22%3A%22String.valueOf(%5C%22Get%20Message%20PP%20profiles%5C%22)%22%2C%22isSelect%22%3Afalse%2C%22funcName%22%3A%22%22%2C%22filterType%22%3A%22%22%2C%22drools%22%3A%22%22%2C%22collectionAttribute%22%3Afalse%2C%22refId%22%3A%22%22%7D%5D",
          "OutcomeEquationDrools": "MomentParam[] params = new MomentParam[] {new MomentParam(\"OfferName\",\"${#TestCase#RGRMOMENTNAME}\"),new MomentParam(\"QualifyingDateAttributeValue\", new Date() )};\_r\nMomentParam[] outcomeValues = null;\_r\nmo.add(new MomentOutcome(\"${#TestCase#RGRMOMENTNAME}\",String.valueOf(\"Get Message PP profiles\"),params, outcomeValues));\_r\n",
          "FormulaName": "MESSAGE",
          "Status": "P"         
        },
        "MomentQualifyingRule": {
          "MomentCode": "${#TestCase#RGRMOMENTNAME}",
          "EventType": "GetProfileById",
          "OfferName": "${#TestCase#RGRMOMENTNAME}",
          "RuleEquationUI": "GetProfileById.ProgramCode==\"PP\"",
           "RuleEquationDrools": "GetProfileByIdC(ProgramCode == \"PP\")",
          "Status": "P"
          
        },
        "Status": "P"
        
      }
    ],
   "Status": "P"
   
  },
  
 
  "BestOfferIndicator": false,
  "AdvancedModeIndicator": false,
  "ReleaseState": "P",
  "IsTestUser": false,
  "Status": "P"
  
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/momentmgmt</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="e66fe6ad-3090-4fbd-b8e1-8027ca200e73" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="contant-type" value="application/json"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>contant-type</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="transfer" name="SetMomentId" id="1416b41a-18fd-4839-894d-62a44bb565ca">
    <con:settings/>
    <con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>momentid</con:name>
        <con:sourceType>Response</con:sourceType>
        <con:sourceStep>CreateMoment</con:sourceStep>
        <con:sourcePath>['MomentId']</con:sourcePath>
        <con:targetType>momentid</con:targetType>
        <con:targetStep>#TestCase#</con:targetStep>
        <con:targetPath/>
        <con:type>JSONPATH</con:type>
        <con:targetTransferType>JSONPATH</con:targetTransferType>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="ActivateMoment" id="2963b055-5fff-45f1-90f1-9de992ea259a">
    <con:settings/>
    <con:config service="RestAPIs" methodName="ActivateMoment" resourcePath="/api/v1/momentmgmt/{momentId}/activate" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="ActivateMoment" id="83e08a66-8efd-4474-b1a8-ffeea07c82d6" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/momentmgmt/activate</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="4b8327be-e8c5-42f7-8e94-88ef80a45263" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>204</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="momentId" value="${#TestCase#momentid}"/>
        </con:parameters>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="MomentEngineReload" id="fc1b2323-c80d-4c69-b2b5-65055cb2c88f">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/operations/engine/refresh" methodName="RefreshEngine" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="MomentEngineReload" id="57c47b89-fe65-498e-93ba-cc0119906e4b" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/operations/engine/refresh</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="918cf777-639c-4ba9-a4b8-3b2f3492ed9c" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="isSyncProcess" value="True"/>
          <con:entry key="refreshAllEngines" value="True"/>
          <con:entry key="Accept-Language" value="en-US"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>refreshAllEngines</con:entry>
          <con:entry>isSyncProcess</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="EnrollProfileWithPP" id="f30c2420-3795-41c0-a313-59b347945663">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v2/profiles" methodName="ProcessProfile" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="EnrollProfileWithPP" id="7ffc0d09-b764-4db2-b34a-6840828b8ab9" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "Prefix":"${Profile#Prefix}",
  "FirstName":"${Profile#FirstName}",
  "MiddleInit":"",
  "LastName":"${Profile#LastName}",
  "CardNumber":"${=java.util.UUID.randomUUID()}",
  "Suffix": "",
  "GlobalOptOut": "${Profile#GlobalOptOut}",
  "GlobalOptDate":  "${Profile#GlobalOptDate}",
  "GlobalOptSource": "",
  "LanguageCode":  "${Profile#LanguageCode}",
  "MaritalStatus": "${Profile#MaritalStatus}",
  "Gender": "${Profile#Gender}",
  "BirthDate": "${Profile#BirthDate}",
  "CompanyName": "${Profile#CompanyName}",
  "Addresses": [
    {
      "AddressLine1":"${Profile#AddressLine1}",
      "AddressLine2": "${Profile#AddressLine2}",
      "AddressLine3": "",
      "City": "${Profile#City}",
      "StateCode": "${Profile#StateCode}",
      "CountryCode":  "${Profile#CountryCode}",
      "PostalCode": "${Profile#PostalCode}",
      "ChannelCode": "${Profile#AddressChannelCode}",
      "LocationCode": "${Profile#AddressLocationCode}",
      "IsPreferred": "${Profile#AddressIsPreferred}",
      "DeliveryStatus": "${Profile#AddressDeliveryStatus}",
      "DoNotStandardize":  "${Profile#DoNotStandardize}"
    }
  ],
  "Emails": [
    {
      "EmailAddress": "${Profile#EmailAddress}",
      "ChannelCode":  "${Profile#EmailChannelCode}",
      "LocationCode": "${Profile#EmailLocationCode}",
      "IsPreferred":  "${Profile#EmailIsPreferred}",
      "DeliveryStatus": "${Profile#EmailDeliveryStatus}"
    }
  ],
  "Phones": [
    {
      "PhoneNumber":  "${Profile#PhoneNumber}",
      "PhoneCountryCode":  "${Profile#PhoneCountryCode}",
      "AcceptsText":"${Profile#AcceptsText}",
      "Frequency": "${Profile#Frequency}",
      "ChannelCode":"${Profile#PhoneChannelCode}",
      "LocationCode":"${Profile#PhoneLocationCode}",
      "IsPreferred": "${Profile#PhoneIsPreferred}",
      "DeliveryStatus":"${Profile#PhoneDeliveryStatus}"
    }
  ],
  "SourceCode": "${Profile#SourceCode}",
  "JoinDate":"${Profile#JoinDate}",
  "EnrollChannelCode": "${Profile#EnrollChannelCode}",
   "Username":  "${Profile#Username}${=java.util.UUID.randomUUID()}",
  "Password": "${Profile#Password}",
  "TermsConditionsAcceptedInd": "${Profile#TermsConditionsAcceptedInd}",
  "CreateFileId":  "${Profile#CreateFileId}",
  "CreateRecordNumber": "${Profile#CreateRecordNumber}",
  "UpdateFileId": 987654323,
  "UpdateRecordNumber": 987654324,
  "AutoRewardOptInInd":  "${Profile#AutoRewardOptInInd}"
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v2/profiles</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="1b124677-3824-405e-b221-49e0e082190c" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${Profile#ProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Authorization</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>content-type</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="ValidateProfileMomentTriggered" id="b8c0fbeb-390c-40e6-af8a-7404ee2ded03">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/profiles/{profileId}" methodName="GetProfileByID" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="ValidateProfileMomentTriggered" id="caa82c6c-fb0c-4527-9a62-8abf1c42fa9d" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/profiles/</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="9d1f8252-1e4e-4cb0-8687-279836b53a06" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="profileId" value="${EnrollProfileWithPP#Response#$['ProfileId']}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#ProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>profileId</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Accept-Language</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>RGRMOMENTNAME</con:name>
      <con:value>RGRMESSAGEMOMENT</con:value>
    </con:property>
    <con:property>
      <con:name>momentid</con:name>
      <con:value>35523012-b69c-4302-943b-5cbf323dca49</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>cb5289a4-b39f-46f8-8d42-768597ab639e</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>b075b5f3-342a-453b-8fe0-d66455b0f1f7</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>98dec0ca-1481-4849-85e1-1989c5b483e2</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>98961bb1-29c4-4aca-80ae-1cdd3721c65a</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>b525d985-b13b-4d4e-9788-0980e8830f53</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>2fd03dd8-f719-44f2-a26f-9c92741d2541</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
