<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="591d7dfb-5670-496e-a426-5423b6444eaf" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="CreateOffer" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="591d7dfb-5670-496e-a426-5423b6444eaffileName">CreateOffer</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="datasource" name="ProgramOffers" id="2e8cd952-7fb8-47c8-8ec5-74891434a6bb">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="File">
        <con:configuration>
          <fileName>${#Project#ProjectPath}/References/ProgramOffers.csv</fileName>
          <separator>,</separator>
          <trim>true</trim>
          <charset>Cp1252</charset>
          <quotedValues>false</quotedValues>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>ProgramCode</con:property>
      <con:property>OfferCode</con:property>
      <con:property>OfferStartDate</con:property>
      <con:property>OfferEndDate</con:property>
      <con:property>OptInRequired</con:property>
      <con:property>DaysValid</con:property>
      <con:property>OfferName</con:property>
      <con:property>OfferName1</con:property>
      <con:property>OfferName2</con:property>
      <con:property>OfferName3</con:property>
      <con:property>OfferName4</con:property>
      <con:property>OfferName5</con:property>
      <con:property>OfferName6</con:property>
      <con:property>OfferShortDescription</con:property>
      <con:property>OfferShortDescription1</con:property>
      <con:property>OfferShortDescription2</con:property>
      <con:property>OfferShortDescription3</con:property>
      <con:property>OfferShortDescription4</con:property>
      <con:property>OfferShortDescription5</con:property>
      <con:property>OfferShortDescription6</con:property>
      <con:property>OfferDescription</con:property>
      <con:property>OfferDescription1</con:property>
      <con:property>OfferDescription2</con:property>
      <con:property>OfferDescription3</con:property>
      <con:property>OfferDescription4</con:property>
      <con:property>OfferDescription5</con:property>
      <con:property>OfferDescription6</con:property>
      <con:property>OfferTermsAndConditions</con:property>
      <con:property>OfferTermsAndConditions1</con:property>
      <con:property>OfferTermsAndConditions2</con:property>
      <con:property>OfferTermsAndConditions3</con:property>
      <con:property>OfferTermsAndConditions4</con:property>
      <con:property>OfferTermsAndConditions5</con:property>
      <con:property>OfferTermsAndConditions6</con:property>
      <con:property>UsageLimit</con:property>
      <con:property>RedemptionCodeReqInPurchase</con:property>
      <con:property>ImageNameSmall</con:property>
      <con:property>ImageNameMedium</con:property>
      <con:property>ImageNameLarge</con:property>
      <con:property>IsCouponOffer</con:property>
      <con:property>CustomDataName</con:property>
      <con:property>CustomDataValue</con:property>
      <con:property>GlobalLimit</con:property>
      <con:property>IsEligibleOffer</con:property>
      <con:property>InvalidCustomDataName</con:property>
      <con:startRow>1</con:startRow>
      <con:endRow/>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>true</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="GetProgramOffers" id="f7231440-df50-4b8e-ac35-7a912457d93d">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/sysoffers" methodName="Get Program Offers" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="GetProgramOffers" id="01b55446-a40a-4369-9fab-5cac544244cc" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/sysoffers</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="92f1c656-9978-407d-9054-0b6766e103c5" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="pageNumber" value=";`"/>
          <con:entry key="offerCode" value="${#TestCase#offerCode}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#ProgramCode}"/>
          <con:entry key="status" value="A"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>offerCode</con:entry>
          <con:entry>offerName</con:entry>
          <con:entry>status</con:entry>
          <con:entry>shortDescription</con:entry>
          <con:entry>startDate</con:entry>
          <con:entry>endDate</con:entry>
          <con:entry>isCouponOffer</con:entry>
          <con:entry>offerType</con:entry>
          <con:entry>isDefaultOffer</con:entry>
          <con:entry>customDataName</con:entry>
          <con:entry>customDataValue</con:entry>
          <con:entry>sortBy</con:entry>
          <con:entry>numberPerPage</con:entry>
          <con:entry>pageNumber</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="47bb433b-fb70-41f0-b289-86004efd1deb">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="UpsertProgramOffer" id="50162c87-070c-4236-8044-67d995497f0f">
    <con:settings/>
    <con:config>
      <script>import static com.jayway.jsonpath.JsonPath.parse

def status = context.expand( '${GetProgramOffers#HarResponse#$[\'status\']}' ).toInteger();
def rewardId = context.expand('${GetProgramOffers#Response#$[\'sys\']}')



if (status == 404 )  testRunner.gotoStepByName("AddProgramOffers")
else if (status == 200)   testRunner.gotoStepByName("UpdateProgramOffers")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="UpdateProgramOffers" id="090732f0-b549-434b-9052-1fe796430f0f">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/sysoffers/{sysOfferId}" methodName="Update Program Offer" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="UpdateProgramOffers" id="ee2ad520-1d32-4346-a597-2616b62150b9" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "OfferCode": "${#TestCase#offerCode}",
  "OfferDescription": "${ProgramOffers#OfferDescription}",
  "OfferStartDate": "${=new java.text.SimpleDateFormat("yyyy-MM-dd").format(new Date())}",
  "OfferEndDate":"${=new java.text.SimpleDateFormat("yyyy-MM-dd'T'23:59:59.999").format(new Date()+365)}",
  "OfferShortDescription": "${ProgramOffers#OfferShortDescription}",
  "OptInRequired": "${ProgramOffers#OptInRequired}",
  "DaysValid": "${ProgramOffers#DaysValid}",
  "OfferName": "${ProgramOffers#OfferName}",
  "OfferTermsAndConditions": "${ProgramOffers#OfferTermsAndConditions}",
  "OfferName1": "${ProgramOffers#OfferName1}",
  "OfferShortDescription1": "${ProgramOffers#OfferShortDescription1}",
  "OfferDescription1":"${ProgramOffers#OfferDescription1}",
  "OfferTermsAndConditions1": "${ProgramOffers#OfferTermsAndConditions1}",
  "OfferName2": "${ProgramOffers#OfferName2}",
  "OfferShortDescription2": "${ProgramOffers#OfferShortDescription2}",
  "OfferDescription2": "${ProgramOffers#OfferDescription2}",
  "OfferTermsAndConditions2": "${ProgramOffers#OfferTermsAndConditions2}",
  "OfferName3": "${ProgramOffers#OfferName3}",
  "OfferShortDescription3": "${ProgramOffers#OfferShortDescription3}",
  "OfferDescription3": "${ProgramOffers#OfferDescription3}",
  "OfferTermsAndConditions3": "${ProgramOffers#OfferTermsAndConditions3}",
  "OfferName4": "${ProgramOffers#OfferName4}",
  "OfferShortDescription4": "${ProgramOffers#OfferShortDescription4}",
  "OfferDescription4": "${ProgramOffers#OfferDescription4}",
  "OfferTermsAndConditions4": "${ProgramOffers#OfferTermsAndConditions4}",
  "OfferName5": "${ProgramOffers#OfferName5}",
  "OfferShortDescription5": "${ProgramOffers#OfferShortDescription5}",
  "OfferDescription5": "${ProgramOffers#OfferDescription5}",
  "OfferTermsAndConditions5": "${ProgramOffers#OfferTermsAndConditions5}",
  "OfferName6": "${ProgramOffers#OfferName6}",
  "OfferShortDescription6": "${ProgramOffers#OfferShortDescription6}",
  "OfferDescription6": "${ProgramOffers#OfferDescription6}",
  "OfferTermsAndConditions6": "${ProgramOffers#OfferTermsAndConditions6}",
  "UsageLimit": ${ProgramOffers#UsageLimit},
  "RedemptionCodeReqInPurchase": "${ProgramOffers#RedemptionCodeReqInPurchase}",
  "ImageNameSmall": "${ProgramOffers#ImageNameSmall}",
  "ImageNameMedium": "${ProgramOffers#ImageNameMedium}",
  "ImageNameLarge": "${ProgramOffers#ImageNameLarge}",
  "IsCouponOffer":"${ProgramOffers#IsCouponOffer}",
   "Status": "A",
"GlobalLimit": ${ProgramOffers#GlobalLimit},
    "OfferCustomDataGroup": {
    "CustomData": [
      {
        "CustomDataName": "${ProgramOffers#CustomDataName}",
        "CustomDataValue": "${ProgramOffers#CustomDataValue}"
      }
  ]}
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/sysoffers/sysOfferId</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="be19997a-1c00-46a2-9d84-4cd6b400b97b" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#ProgramCode}"/>
          <con:entry key="sysOfferId" value="${GetProgramOffers#Response#$[0]['SysOfferId']}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>sysOfferId</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="47bb433b-fb70-41f0-b289-86004efd1deb">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="UpdateProgramOffersCond" id="bc549828-e664-429e-892b-4d437f8e78f0">
    <con:settings/>
    <con:config>
      <script>import static com.jayway.jsonpath.JsonPath.parse

def status = context.expand( '${UpdateProgramOffers#HarResponse#$[\'status\']}' ).toInteger();

if (status == 200)  testRunner.gotoStepByName("sysOfferId")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="AddProgramOffers" id="8bcfff9a-6b62-4068-a4df-2b79c5b4899e">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/sysoffers" methodName="Add Program Offer" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="AddProgramOffers" id="e6cd6a15-8800-4f34-912b-da1e6f9af091" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
    "OfferCode": "${#TestCase#offerCode}",
    "ProgramCode": "PP",
    "OfferDescription": "Offer description",
    "OfferStartDate": "${=new java.text.SimpleDateFormat("yyyy-MM-dd").format(new Date())}",
    "OfferEndDate":"${=new java.text.SimpleDateFormat("yyyy-MM-dd'T'23:59:59.999").format(new Date()+365)}",
    "OfferShortDescription": "Description ",
    "OptInRequired": true,
    "OfferName": "AOFFER88",
    "OfferType": "",
    "OfferTermsAndConditions": "",
    "OfferImageSmallAlt": "",
    "OfferImageMediumAlt": "",
    "OfferImageLargeAlt": "",
    "RedemptionCodeReqInPurchase": false,
    "IsDefaultOffer": true,
    "Status": "A"
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/sysoffers</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="da0c8189-c886-4c26-8042-35480e4d8a20" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#ProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="47bb433b-fb70-41f0-b289-86004efd1deb">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="sysOfferId" id="a004caec-0578-46da-a59e-1e4e07e1282a">
    <con:settings/>
    <con:config>
      <script>def rewardId = context.expand('${GetProgramOffers#Response#$[\'sysOfferId\']}')
def responseAddReward = context.expand( '${AddProgramOffers#Response}' )
def responseUpdateReward = context.expand('${UpdateProgramOffers#Response}')

if(responseAddProgramOffers==null || responseAddProgramOffers=="")
 {
 	if(responseUpdateProgramOffers ==null || responseUpdateProgramOffers  =="")
 	{
 		return sysOfferId
 	}
 	else
 	{
 		sysOfferId = context.expand( '${UpdateProgramOffers#Response#$[\'sysOfferId\']}' )
   		 return sysOfferId;
 	}
 }
 else
 {
   sysOfferId = context.expand( '${AddProgramOffers#Response#$[\'sysOfferId\']}' )
    return sysOfferId;
 }</script>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>offerCode</con:name>
      <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>50162c87-070c-4236-8044-67d995497f0f</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>bc549828-e664-429e-892b-4d437f8e78f0</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>2e8cd952-7fb8-47c8-8ec5-74891434a6bb</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
