<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="7138517e-21cc-422e-ad37-01b6de30e14e" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Internal-Coupon" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="7138517e-21cc-422e-ad37-01b6de30e14efileName">Internal-Coupon</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="restrequest" name="Enable Retail Matchback" id="50a2b768-72ce-4761-9f84-ecb759df9d84">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/programsettings" methodName="UpdateProgramSettings" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest id="d3640b0f-5085-4ed6-8b0e-f59fb4fdaab6" mediaType="application/json" name="Enable Retail Matchback" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          <con:setting id="RecordRequestRepresentations">true</con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>[{
  "ParameterName":  "RETAIL_MATCHBACK_ENABLED",
  "ParameterValue":  "Y" 
}]</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/programsettings</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="34324ec9-3db2-4b60-b62b-bcad32f3e796" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Authorization</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>content-type</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Get RMB Offer" id="2460e21d-b8e0-4486-b3c3-5f13a9347809">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/sysoffers" methodName="Get Program Offers" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Get RMB Offer" id="01b55446-a40a-4369-9fab-5cac544244cc" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/sysoffers</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="256bb0e1-0971-4d06-ade0-bc1bbb8852d3" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="pageNumber" value=""/>
          <con:entry key="offerCode" value="${#TestCase#OfferCode}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>offerCode</con:entry>
          <con:entry>offerName</con:entry>
          <con:entry>status</con:entry>
          <con:entry>shortDescription</con:entry>
          <con:entry>startDate</con:entry>
          <con:entry>endDate</con:entry>
          <con:entry>isCouponOffer</con:entry>
          <con:entry>offerType</con:entry>
          <con:entry>isDefaultOffer</con:entry>
          <con:entry>customDataName</con:entry>
          <con:entry>customDataValue</con:entry>
          <con:entry>sortBy</con:entry>
          <con:entry>numberPerPage</con:entry>
          <con:entry>pageNumber</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Goto Activate If Exists" id="a4a42a78-0bbc-4ed9-a118-c4c59554e1b2">
    <con:settings/>
    <con:config>
      <script>def response = context.expand( '${Get RMB Offer#Response#$.[0].SysOfferId}' )

if(response!="") {
	context.testCase.setPropertyValue('OfferId',response)
	testRunner.gotoStepByName("Activate Offer")
}</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Add Offer" id="7e2a2fb3-956c-4c70-863e-25efe8a9637e">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/sysoffers" methodName="Add Program Offer" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Add Offer" id="e6cd6a15-8800-4f34-912b-da1e6f9af091" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "OfferCode": "${#TestCase#OfferCode}",
  "OfferStartDate": "${=new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ").format(new Date())}",
  "OfferEndDate": "${=new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ").format(new Date())}",
  "OfferShortDescription": "Rmb Coupon",
  "OptInRequired": false,
  "OfferName": "Retailmatchback Coupon",
  "OfferTimeZone": "UTC",
  "IsCouponOffer": true,
  "Status": "A",
  "isNew": false,
  "RedemptionCodeReqInPurchase": true,
  "RedemptionCodeReqInPurchaseOpposite": false,
  "IsAvailable": "AVAILABLE",
  "IsEligibleOffer": false,
  "IsDefaultOffer": false,
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/sysoffers</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="771a4f39-ca5a-4cee-9cc4-fa6da9a510a6" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="transfer" name="Extract Offer Id" id="0489ae87-e3b4-4e93-9ce0-7588b1d1c16b">
    <con:settings/>
    <con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="true" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>SysOfferId</con:name>
        <con:sourceType>Response</con:sourceType>
        <con:sourceStep>Add Offer</con:sourceStep>
        <con:sourcePath>SysOfferId</con:sourcePath>
        <con:targetType>OfferId</con:targetType>
        <con:targetStep>#TestCase#</con:targetStep>
        <con:targetPath/>
        <con:type>JSONPATH</con:type>
        <con:targetTransferType>JSONPATH</con:targetTransferType>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Add Offer Coupon" id="e72e0715-764c-4fbe-8877-ed7c5130aa82">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/offers/{sysOfferId}/coupons" methodName="Add Offer Coupon" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Add Offer Coupon" id="20618720-2ce6-4993-a45b-4ea75252c6a0" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "RedemptionCodeType": "AUTO_GENERATED",
  "IsIndividual": true,
  "Status": "A",
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/offers/11af9ada-7c73-48bb-9049-ce04a94930e8/coupons</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="ba2de464-f732-4db0-b289-ec9a646b13eb" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
          <con:entry key="sysOfferId" value="${#TestCase#OfferId}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>sysOfferId</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Activate Offer" id="71810638-cc4f-43b0-bb46-f713e07b54a5">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/sysoffers/{sysOfferId}" methodName="Update Program Offer" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Activate Offer" id="ee2ad520-1d32-4346-a597-2616b62150b9" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "OfferCode": "${#TestCase#OfferCode}",
  "OfferStartDate": "2020-02-01T00:00:00Z",
  "OfferEndDate": "2022-01-01T00:00:00Z",
  "OfferShortDescription": "Rmb Coupon",
  "OptInRequired": false,
  "OfferName": "Retailmatchback Coupon",
  "OfferTimeZone": "UTC",
  "IsCouponOffer": true,
  "Status": "A",
  "isNew": false,
  "RedemptionCodeReqInPurchase": true,
  "RedemptionCodeReqInPurchaseOpposite": false,
  "IsAvailable": "AVAILABLE",
  "IsEligibleOffer": false,
  "IsDefaultOffer": false,
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/sysoffers/sysOfferId</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="fda1d205-0e5a-4af1-a6af-254489b38ee3" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
          <con:entry key="sysOfferId" value="${#TestCase#OfferId}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>sysOfferId</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="AddProfileRGRCRM" id="c6f2c747-7f98-4e8d-867d-4c0e43727b0e">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>a2017b8c-3964-4e51-b21c-9ae14e06a6f7</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>ProfileId</con:name>
          <con:value>d87dc95d-815a-4d98-889c-0f89a7942f31</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties>
        <con:entry>ProfileId</con:entry>
      </con:returnProperties>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Add Offer To Profile" id="33efbc65-063b-465b-9487-225269457f43">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v2/profiles/sysoffers" methodName="Process Profile Program Offer" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Add Offer To Profile" id="0896945e-1d87-42cf-9d01-21a267eb9d20" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "SysOfferId": "${#TestCase#OfferId}",
  "ProfileId": "${AddProfileRGRCRM#ProfileId}"
}</con:request>
        <con:originalUri>https://q7intg-pveapi.epsilonagilityloyalty.com/api/v2/profiles/sysoffers</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="73f19874-82e9-43d5-a571-b86a2e485348" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Authorization</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>Accept-Language</con:entry>
        </con:parameterOrder>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="Add Anon Transaction with Coupon" id="90834d66-3076-4e8e-a74a-c6e55c04489d">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>676fcae3-99fe-447d-af5c-71dc4bdc14a2</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>TransactionNumber</con:name>
          <con:value>${=java.util.UUID.randomUUID()}</con:value>
        </con:property>
        <con:property>
          <con:name>ProfileId</con:name>
        </con:property>
        <con:property>
          <con:name>TransactionDate</con:name>
          <con:value>${=new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssZ").format(new Date())}</con:value>
        </con:property>
        <con:property>
          <con:name>CouponNumber</con:name>
          <con:value>${Add Offer To Profile#Response#$['Coupons'][0]['SysRedemptionCode']}</con:value>
        </con:property>
        <con:property>
          <con:name>CouponAmount</con:name>
          <con:value>1</con:value>
        </con:property>
        <con:property>
          <con:name>ProgramCode</con:name>
          <con:value>${#Project#CrmProgramCode}</con:value>
        </con:property>
        <con:property>
          <con:name>StoreCode</con:name>
          <con:value>CRM_1</con:value>
        </con:property>
        <con:property>
          <con:name>RawTransactionId</con:name>
          <con:value>b419b560-7952-48d0-9b36-963b4f03ff6e</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties>
        <con:entry>RawTransactionId</con:entry>
      </con:returnProperties>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="Execute Internal Retail Matchback" id="6f073a4b-6685-490f-a719-2797d79960ce">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>ef17d7c2-c35c-4169-9d70-a739d6485410</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>ProgramCode</con:name>
          <con:value>${#Project#CrmProgramCode}</con:value>
        </con:property>
        <con:property>
          <con:name>JobName</con:name>
          <con:value>InternalMatchback_Coupon</con:value>
        </con:property>
        <con:property>
          <con:name>JobTypeId</con:name>
          <con:value>12bed4d7-2954-495a-af0c-cb74cc6bcc04</con:value>
        </con:property>
        <con:property>
          <con:name>JobId</con:name>
          <con:value>8ee68e91-7f80-4d4d-a026-c427b7e5ff30</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties>
        <con:entry>JobId</con:entry>
      </con:returnProperties>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="calltestcase" name="Wait For Job" id="df2279ac-4d1a-4f20-8e6d-486e9c0a1ce5">
    <con:settings/>
    <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:targetTestCase>1525e308-cfae-4277-af49-4908cfbd9e1d</con:targetTestCase>
      <con:properties>
        <con:property>
          <con:name>JobId</con:name>
          <con:value>${Execute Internal Retail Matchback#JobId}</con:value>
        </con:property>
      </con:properties>
      <con:returnProperties/>
      <con:runMode>SINGLETON_AND_WAIT</con:runMode>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Get Transaction and check for match" id="3908788d-2bf4-445e-8c38-d3d7942cd11c">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v2/transaction/rawtransactions/{rawtransactionid}" methodName="GetTransactionById" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Get Transaction and check for match" id="d866248f-9e10-4bc6-824e-b2fc2f226a21" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request/>
        <con:originalUri>https://q7intg-pveapi.epsilonagilityloyalty.com/api/v2/transaction/rawtransactions/</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="2d539fa6-8f4e-499c-a51c-11ac8c0185c1" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="JsonPath Existence Match" id="f7c6815e-2d62-4679-9111-2fbcb423f64d" name="JSONPath Existence Match">
          <con:configuration>
            <path>ProfileId</path>
            <content>true</content>
            <allowWildcards>false</allowWildcards>
            <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
            <ignoreComments>false</ignoreComments>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="profileid" value="${AddProfileRGRCRM#ProfileId}"/>
          <con:entry key="rawtransactionid" value="${Add Anon Transaction with Coupon#RawTransactionId}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>rawtransactionid</con:entry>
          <con:entry>profileid</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Deactivate Offer" id="0f6f18d1-a129-42f9-b203-03bf06657ea3">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/sysoffers/{sysOfferId}" methodName="Update Program Offer" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Deactivate Offer" id="ee2ad520-1d32-4346-a597-2616b62150b9" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://d3aldv-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>{
  "OfferCode": "${#TestCase#OfferCode}",
  "OfferStartDate": "2020-01-01T00:00:00Z",
  "OfferEndDate": "2022-01-01T00:00:00Z",
  "OfferShortDescription": "Rmb Coupon",
  "OptInRequired": false,
  "OfferName": "Retailmatchback Coupon",
  "OfferTimeZone": "UTC",
  "IsCouponOffer": true,
  "Status": "I",
  "isNew": false,
  "RedemptionCodeReqInPurchase": true,
  "RedemptionCodeReqInPurchaseOpposite": false,
  "IsAvailable": "AVAILABLE",
  "IsEligibleOffer": false,
  "IsDefaultOffer": false,
}</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/sysoffers/sysOfferId</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="fda1d205-0e5a-4af1-a6af-254489b38ee3" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
          <con:entry key="sysOfferId" value="${#TestCase#OfferId}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>sysOfferId</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>Authorization</con:entry>
          <con:entry>content-type</con:entry>
          <con:entry>Program-Code</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Disable Retail Matchback" id="74a5e497-c7fc-4f7b-9e1d-7c87d01d2c67">
    <con:settings/>
    <con:config service="RestAPIs" resourcePath="/api/v1/referencedata/programs/programsettings" methodName="UpdateProgramSettings" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest id="d3640b0f-5085-4ed6-8b0e-f59fb4fdaab6" mediaType="application/json" name="Disable Retail Matchback" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          <con:setting id="RecordRequestRepresentations">true</con:setting>
        </con:settings>
        <con:endpoint>https://q3alin-pveapi.skynetlowerenv.com/</con:endpoint>
        <con:request>[{
  "ParameterName":  "RETAIL_MATCHBACK_ENABLED",
  "ParameterValue":  "N" 
}]</con:request>
        <con:originalUri>https://q3alin-pveapi.skynetlowerenv.com/api/v1/referencedata/programs/programsettings</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="34324ec9-3db2-4b60-b62b-bcad32f3e796" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="Authorization" value="OAuth ${#Project#AuthToken}"/>
          <con:entry key="content-type" value="application/json"/>
          <con:entry key="Accept-Language" value="en-US"/>
          <con:entry key="Program-Code" value="${#Project#CrmProgramCode}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>Authorization</con:entry>
          <con:entry>Program-Code</con:entry>
          <con:entry>Accept-Language</con:entry>
          <con:entry>content-type</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="d653788f-b849-4013-8db6-47ad297cdee5">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>OfferCode</con:name>
      <con:value>RMB_COUPON</con:value>
    </con:property>
    <con:property userSpecific="true">
      <con:name>OfferId</con:name>
      <con:value>dac9f88d-5d82-4ae5-89d0-600ab9dd63d0</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>2460e21d-b8e0-4486-b3c3-5f13a9347809</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>e72e0715-764c-4fbe-8877-ed7c5130aa82</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>0489ae87-e3b4-4e93-9ce0-7588b1d1c16b</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>71810638-cc4f-43b0-bb46-f713e07b54a5</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>33efbc65-063b-465b-9487-225269457f43</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>3908788d-2bf4-445e-8c38-d3d7942cd11c</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>6f073a4b-6685-490f-a719-2797d79960ce</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>df2279ac-4d1a-4f20-8e6d-486e9c0a1ce5</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:environmentSpec>
    <con:entry environmentId="3c955a23-3567-47af-b6e9-aacfcca8d9aa">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
  </con:environmentSpec>
</con:testCase>
